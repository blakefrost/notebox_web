<style type="text/css" media="screen">
  .green {
    color: green;
  }
  .red {
    color: red;
  }


</style>

<script type="text/javascript" charset="utf-8">
  function getPassword(el){
    password = prompt("Give me your password");
    el.href = el.href + "&password=" + password;
  }
</script>

<div class="container">
  <% if flash[:notice] %>
    <div class="alert alert-info">
      <%= flash[:notice] %>
    </div>
  <% end -%>

  DNS Proxy is
  <% if @running %>
    <strong class="green">Running</strong>&nbsp;&nbsp;
    <a class="btn btn-primary" data-method="PUT" onclick="getPassword(this);" href="/dns?state=restart"><i class="fa fa-refresh fa-fw"></i> Restart</a>
    <a class="btn btn-danger" data-method="PUT" onclick="getPassword(this);" href="/dns?state=stop"><i class="fa fa-stop fa-fw"></i> Stop</a>
  <% else %>
    <strong class="red">Stopped</strong>&nbsp;&nbsp;
    <a class="btn btn-success" data-method="PUT" onclick="getPassword(this);" href="/dns?state=start"><i class="fa fa-play fa-fw"></i> Start</a>
  <% end -%>

  <hr>
  <h4>Blocked List</h4>

  <table class="table blocked-list">
    <% @blocked_list.each do |bd| %>
      <tr>
        <td>
          <%= bd.value %>
          <% if bd.blocked %>
            <span class="label label-danger">Blocked</span>
          <% else -%>
            <span class="label label-success">Allowed</span>
          <% end -%>
        </td>
        <td>
          <% if bd.blocked %>
            <a class="btn btn-xs btn-success" href="<%= blocked_domain_path(bd, blocked_domain: { blocked: false }) %>" data-method="PUT"><i class="fa fa-play fa-fw"></i> Allow Traffic</a>
          <% else -%>

            <a class="btn btn-xs btn-danger" href="<%= blocked_domain_path(bd, blocked_domain: { blocked: true }) %>" data-method="PUT"><i class="fa fa-stop fa-fw"></i> Block Traffic</a>
          <% end -%>
          <a class="btn btn-xs pull-right" href="<%= blocked_domain_path(bd) %>" data-method="DELETE" data-confirm="Delete Blocked Domain?"><i class="fa fa-times fa-fw"></i></a>
        </td>
      </tr>
    <% end -%>
    <tr>
      <td colspan="2">
        <form class="form-inline" action="/blocked_domains" method="post">
          <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          <div class="form-group">
            <input type="text" name="blocked_domain[value]" class="form-control" placeholder="Domain">
          </div>
          <button type="submit" class="btn btn-default">Add</button>
        </form>
      </td>
    </tr>
  </table>

  <br>

  <hr>
  <h4>Host Configuration</h4>
  <textarea class="form-control" rows="10"><%= @host_configuration %></textarea>
  <hr>
  <h4>If the buttons here doesn't work:</h4>

  <br>
  Manual start
  <br><br>
  <pre>$ sudo dnsproxy.py -s 8.8.8.8 &lt;/dev/null &amp;&gt;/dev/null &amp;</pre>

  Maunal stop
  <br>
  <br>
  <pre>$ sudo pkill -f dnsproxy</pre>



</div>
